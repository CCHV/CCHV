\section{Introduction}\label{section::Intro}
Ion beam therapy is a cancer treatment technique which is rapidly gaining importance in the global tumor therapy panorama. In addition to the already operational 70 clinical facilities, with more than 175000 patients already treated by the end of 2017, several new centers have been designed and approved for construction worldwide~\cite{PTCOG_stats}. The favorable feature of this treatment technique is connected to the peculiar energy deposition profile of charged particles as a function of depth in matter. As first observed by Bragg~\cite{Bragg_main}, the depth-dose profile of charged particles shows a maximum close to the end of their range in matter; in addition to this, a strong enhancement of the relative biological effectiveness (RBE) is observed for ions heavier than protons in the region of the Bragg peak~\cite{RBE_Elsasser, RBE_Weyrather}, which further enhances the 
dose ratio between target and healthy tissues.

The maximum of the dose is deposited in the Bragg peak region in the patient and must be tuned to cover the target volume (defined via CT scan) and, at the same time, spare the surrounding healthy tissues. Treatment planning and delivery uncertainties limit the tumour targeting capabilities, like uncertainties in the material composition determination, CT units conversion to ion stopping power, patient mis-positioning, organ motion or morphological changes between treatment fractions. These uncertainties force the clinicians to fix relatively large safety margins around the planned treatment volume, up to 3.5\% + 3 mm~\cite{Paganetti:2012aa}. Ion-range verification is one of the conditions required for a broader usage of ion beam therapy and for its further development. With the goal of fully exploiting the ion beam therapy dosimetric potential, the monitoring should be in real-time and ideally in 3 dimensions, in order to detect important deviations between the planned and delivered dose to the target volume or to surrounding organs, in particular in case of proximity to organs-at-risk~(OAR). This capability would allow for a reduction of the above mentioned safety margins and for a better tumor targeting; in addition to this, it could permit the use of new irradiation fields with OAR downstream with respect to the tumor position~\cite{Knopf:2013aa}.   

Several range verification techniques have been considered worldwide for twenty years. Most of them rely on the detection of secondary radiation generated during the slowing down process of incident ions, in particular during nuclear reactions. Among theses secondary radiations, positron emitters have been deeply studied in order to exploit positron emission tomography (PET) machines for treatment monitoring. The only available and functional range monitoring systems in a clinical center are based on this technique~\cite{ENGHARDT2004, Yamaya2018}, which is anyway affected by physical and technical limitations\cite{PARODI2016}.

%PET techniques are based on the detection of the two back-to-back 511~keV photons produced by the annihilation of positrons (created by the emitter fragments of nuclear reactions) with patient electrons, resulting in a delayed radiation which should be detected with time coincidences, allowing for an intrinsic background reduction. Nevertheless, the monitoring with positron emitters secondary signal must deal with a limited count rate compared to medical imaging PET, with the lifetime of emitters providing a delayed information that implies the signal integration over a whole treatment fraction (not a single spot or group of spots), with physiological washout effects depending on to the emitters lifetime.
%
%Even if the only available and functional range monitoring system in a clinical center is based on this technique~\cite{ENGHARDT2004}, several clinical experience with commercial or adapted PET system already shown intrinsic limitations mainly connected to the ring geometry (not directly applicable to the treatment monitoring due to the presence of the beam) or in general to geometrical constraints limiting the field of view and the resulting system global efficiency and spatial accuracy (the limited detection angle generates artifacts in the final image)~\cite{PARODI2016}. The research is ongoing and new results are expected for the next years thanks to the introductions of new systems with adapted geometries, to the improvements in acquisition and reconstruction techniques and to the clinical introduction of time-of-flight systems, intrinsically able to improve the detector spatial resolution via interaction time information, and depth-of-interaction reconstruction, which will allow for a more precise spatial reconstruction for reduced angular artifacts effects.

In addition to positron annihilation products, the relaxation of excited nuclei also produces secondary photons in a wide energy range, between some hundreds of keV till about 8-10~MeV. After the first idea proposal published in 2003~\cite{PG_first}, these secondary products of particle treatment have been deeply investigated and the correlation of this gamma radiation to the ion depth-dose profile has been confirmed by several research groups, starting from~\cite{Min_PG} for protons and~\cite{Testa_PG} for carbon ions. The so-called prompt gamma-rays (PG) have the advantage to be emitted almost instantaneously after the beam interaction in the tissue, making them more adapted than PET 511~keV gammas for real-time monitoring. Moreover, as shown in~\cite{Robert2013}, the emission rate is comparable to the one of the annihilation gammas for both protons and carbon beams. Consequently, different techniques have been proposed to exploit this signal for treatment monitoring purpose, with the related detection systems. For a review on PG monitoring, see~\cite{krimmer:hal-01585334}.
%Some methods are based on PG timing~\cite{Golnik:2014aa, Krimmer_PGPI} or energy~\cite{Verburg:2014aa} information and rely on non-collimated systems; more complex detection apparatus can achieve an actual PG imaging, by exploiting mechanical or electronic collimation (i.e.~with collimated gamma camera or Compton camera, respectively) for the photon selection (see e.g.~\cite{Min_PG, Bom_collimated, Priegnitz:2015aa, Smeets:2012aa, Roellinghoff_2014, Frandes_2010, LLOSA2012105, KORMOLL2011114, MCCLESKEY2015163, Matsuoka:2014qna, Peterson:2010aa, Solevi:2016aa, ALDAWOOD2017190}). 

Originally designed for astrophysics applications, the potential of Compton cameras for medical imaging has been soon recognized~\cite{TODD:1974aa} and then directly translated to the ion beam therapy monitoring domain. Such a gamma detection system is generally  composed of two sections: a scatterer and an absorber. The scatterer is dedicated to the gamma Compton-scattering, and should be designed to optimize the Compton scattering probability in the prompt gamma energy range, while reducing the so-called Doppler broadening effect due to electron binding and motion~\cite{Doppler}; in most of the cases, this leads to the choice of a light material (low $Z$), segmented in several subsections. On the other hand, heavier materials may be used to improve photon detection efficiency~(\cite{Solevi:2016aa, ALDAWOOD2017190, 0031-9155-60-18-7085}). The absorber finally intends to capture the Compton scattered photons via photoelectric effect and is often composed of segmented high-$Z$ scintillating materials. A slightly different Compton camera configuration can also achieve Compton electron tracking in the scattering detector~\cite{Frandes_2010, Yoshihara_ETCC}, which results in additional information for the further reconstruction algorithm.
 The collected interaction positions and energy depositions in the two detector sections are used to constrain the emission point to the surface of a cone (or to a segment in the cone if the Compton electron track information is retrieved), via Compton kinematics (for an electron initially at rest):
\begin{equation}
\cos\theta\,=\,1-\frac{m_{e}c^{2}E_{1}}{E_{2}(E_{1}+E_{2})},
\label{Compton_equation}
\end{equation} 
where \(m_{e}c^{2} = 511\)~keV, \(E_{1}\) and \(E_{2}\) are the energies, respectively, deposited in the scatterer and the absorber. 
Analytic or iterative algorithms use these cones to create the image of the prompt gamma emission distribution, with intrinsic 3 dimensional capability~\cite{McKisson3D, Kuchment:2016uiw}. 


Several sources of uncertainty and signal background are connected to the above described detection method. The reported Compton kinematics formula (equation~\ref{Compton_equation}) assumes valid the relation in equation~\ref{energy_equation}:
 \begin{equation}
E_{0} = E_{1}+E_{2}.
\label{energy_equation}
\end{equation} 
Since the initial photon energy (\(E_{0}\)) is not known a priori, a complete photon energy absorption is needed for the cone calculation, or at least two photon scattering interactions are required in a single event. An under-estimation of the total initial energy (caused by a photon non-complete absorption in the absorber section or by the Compton electron escape from the scatterer section), leads to a mi-estimation of the Compton angle, so to a Compton cone reconstruction uncertainty. If double scattered photons are selected, the initial photon energy can be calculated analytically so that a complete absorption is not mandatory. In addition to this, the Compton formula considers the Compton scattering electron initially at rest, and its energy configuration creates a blur in the Compton angle reconstruction, resulting in the already cited Doppler broadening effect~\cite{Doppler}. Furthermore, the detection principle is based on time coincidences between the two detector sections, therefore the time structure of the incoming particles plays an important role. The final image accuracy suffers from random coincidences generated by two prompt gammas interacting within the same time window or by contamination of secondaries, mainly neutrons and protons. The effect of random coincidences can be reduced by high detector time resolution or background rejection methods~\cite{Draeger:2017aa}. Energy selections can be applied to the collected coincidences~\cite{Polf:2009aa, Hilaire:2016aa} or the homogeneous neutron background can be reduced via time-of-flight information~\cite{Testa:2010aa}.

Ortega and colleagues~\cite{Ortega:2015aa} presented a detailed analysis of the noise sources for Compton imaging in proton therapy monitoring, and the clinical application of this method for detecting range shifts was tested for the setup under development in Valencia. The simulation study showed the relative expected rate of prompt gammas and neutrons, and the resulting rate of random coincidences ranging from 19 \% to more than 60 \% depending on the beam energy and the coincidence time window. This amount of fake events leads to complex reconstruction scenarios, where the identification of a 3~mm range shift is not clear for all cases.

Starting from these results, we propose in this paper to study with Monte Carlo simulations a Compton camera prototype based on semiconductor and scintillator detectors~\cite{krimmer:hal-01101334, Fontana2018} developed by the CLaRyS collaboration, involving four French research institutions.%: IPNL and CREATIS in Lyon, LPSC in Grenoble, and CPPM in Marseille). % which is currently working on the design and development of gamma detectors for online ion beam therapy monitoring. 
The camera performance is studied with respect to the gamma energy in the prompt gamma energy range. Furthermore, the feasibility of its clinical application as depth-dose profile monitor during ion beam therapy clinical treatment is analyzed. After a preliminary study with point-like gamma sources irradiation focused on detector efficiency measurements as a function of the source position and gamma energy, clinical proton and carbon beams impinging on an homogeneous PMMA phantom are simulated to reproduce treatment conditions and analyze the prompt gamma detection resulting scenario. The ratio between true and random coincidences is studied as a function of the beam intensity. Two kinds of reconstruction algorithms, a line-cone analytic method and a MLEM iterative one, are applied to the collected data in order to compare the imaging results. Finally, the precision with which the dose profile fall-off can be detected with the Compton camera is reported.   


%The ClaRyS collaboration (Institut de Physique Nucleaire and Centre de Recherche en Acquisition et Traitement de l'Image pour la Sant\'e in Lyon, Laboratoire de Physique Subatomique et Cosmologie in Grenoble, Centre de Physique des Particules in Marseille) is currently working on the design and development of gamma detectors for online ion beam therapy monitoring. The project includes the development and clinical test of a Compton camera prototype based on semiconductor and scintillator detectors~\cite{krimmer:hal-01101334}. The feasibility of its clinical application is studied in this work with Monte Carlo simulations.
