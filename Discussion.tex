\section{Discussion}

We studied in this simulation work the performance of the CLaRyS Compton camera prototype and its possible implementation as prompt-gamma detector for ion beam therapy monitoring. The proposed analysis is focused on four main points: detection efficiency for various kind of coincidence events, and for events with a single scatterer layer hit absolute gamma detection efficiency, true and background coincidence rate and camera precision in the identification of the prompt-gamma emission profile fall-off.

The gamma detection efficiency has been measured with the detector exposed to gamma sources at six different energies, in the prompt-gamma energy range. The relative detection efficiency has been studied considering the three possible kinds of true coincidence events: single Compton interactions in the scatterer (2 photon interaction events), Compton recoil electron escape events and events with multiple gamma interactions in the scatterer (3 or more photon-interaction events). The coincidences composed of one single Compton interaction in one of the scatterer layers and an energy deposit in one single absorber blocks represent the majority of the collected events in the whole explored energy range. However, for energies above 1~MeV the amount of electron escape events becomes significant. Such kind of events can be ideally exploited in the reconstruction, and the selection can be based on tracking analysis (if the escaped recoil electron interacts in more than one scatterer layer). In the camera performance evaluation study, only single events have been selected as first approach for a feasibility study of the Compton camera application in ion range monitoring. 
All the results discussed in the following have been obtained with such an event selection.

The absolute camera efficiency variation as a function of the source position has been reported, with an ideal detector and with the application of detection energy thresholds in scatterer (50~keV) and absorber (100~keV). 
For low energies, below 2~MeV, the increased efficiency in the central section of the camera active surface - shown in figure~\ref{fig::efficiency_study}(a) - is linked to the increased relative number of photons approaching the camera with small angles. These photons are more likely undergoing Compton scattering with a reduced energy deposition, which is recorded by an ideal detector and rejected by the fixed energy threshold. The effect is all the more important as the primary gamma energy is limited, creating the peculiar energy dependence of the efficiency reduction observed in the results in figure~\ref{fig::efficiency_study}(b).
Regarding the dependence of the efficiency on the Compton camera position, an accurate setup with respect to the expected Bragg peak position appears mandatory for the detection optimization.

The study of the signal-over-noise ratio as a function of beam intensity was performed (see figure \ref{fig:coincidences}). The results show that, at clinical intensities, this ratio is very low. The TOF selection is effective in the case of carbon beams, where a significant proton and neutron contamination is expected. If we consider the case of proton beams, the amount of background and true coincidences is comparable at an intensity of about 1 proton per bunch, so that a clinical intensity reduction should be necessary to fit this configuration. The profile fall-off retrieval could not be achieved at clinical proton beam intensity for a single spot with the tested reconstruction methods. Even if a possible image reconstruction is not excluded by the low signal-over-noise ratio detected at realistic beam intensity with increased statistics (a group of spots with same expected range), given the fact that the background coincidences are distributed in an homogeneous way in the reconstructed volume, an intensity reduction can be an option in order to obtain more significant data sets. It must be noticed that the need for online check of Bragg peak position is all the more necessary for distal spots, which are in general the firsts to be treated, so that a beam intensity reduction at the beginning of the treatment can be foreseen in case an accurate monitoring is strictly needed. This would not affect the treatment delivery, nor the planned patient rate in the clinical work-flow; indeed, the spreading of the time duration for few spots is of the order of one second. 
In the case of carbon ions, the larger amount of secondary neutron produced during the patient treatment seems to require other background rejection methods in order to lead to an advantageous signal-over-noise ratio. Note also that online filtering strategies may be used to improve the quality of the data (see figure~\ref{fig::rate_full_abs}): already in figure \ref{fig:coincidences}, one can notice that the amount of reconstructed events is about half that of true gamma, which means that partial absorption in the absorber leads to events which cannot be reconstructed via the line-cone method. More refined pre-analysis could be used and have been proposed in \cite{Draeger:2017aa}. Note also that the line-cone reconstruction used here is quite rough: the two reconstruction points are systematically considered, although further selection may refine the procedure and improve the profile quality (for instance, rejecting points outside the planned treatment volume).
Alternative approaches for the optimization of the signal-over-noise ratio should be focused on the camera geometrical design. In~\cite{Fontana_APPB} we tested the same prototype with two absorber configurations, showing an absolute efficiency reduction of a factor approximately two when reducing the absorber from a $8\times6$ block matrix to a $3\times3$ one. Such a significant absorber size reduction is expected to drastically reduce the random coincidence contamination, thus improving the signal-over-noise ratio, with not dramatic efficiency degradation for the FOP monitoring purpose. Moreover, to this efficiency reduction corresponds an increased spatial resolution, probably given by the selection of gamma scattered with small angles. This hypothesis is confirmed by the efficiency variation generated by the applied energy thresholds, as discussed before. 
The design optimization could also foresee the reduction of the number of silicon layers, with a further expected reduction of the background coincidence rate. In addition to the aforementioned advantages, a more compact configuration allows for the implementation of several detector heads, which can be set at different angles and provide additional spatial information, in particular in view of 3D imaging. In case the highest possible efficiency is required, the distance between scatterer and absorber can also be modified, knowing that for reduced distances the efficiency is increased because a minimal amount of scattered photons escapes the absorber field of view. On the other hand, a reduction of the inter-detector distance is not recommended for accurate TOF measurements (for fixed target-scatterer distance), given the uncertainty added by the detectors time resolutions. In addition to this, also the spatial resolution is affected by a reduction of the scatterer-absorber distance, given the increased amount of photons scattered with large Compton angles included in the collected events. Indeed, large angle scatterings tend to degrade the spatial resolution. Dedicated design studies will be performed in the next future to address the proposed improvements.  

The camera precision has been estimated for proton beams at the reduced intensity of 1 proton per bunch on average, starting from a reference prompt gamma emission profile obtained at high primary particle statistics (2$\times$10$^{10}$), with the random extraction of 100 data subsets per number of incident protons (LM-MLEM precision) and the realization of 1000 profiles with Poisson generated statistical fluctuations (line-cone precision) and applying a robust minimization algorithm to define the shift of the identified profile fall-off with respect to the reference one.
The camera precision in the fall-off identification rapidly increases for increasing primary particle statistics. A sufficiently good precision is achieved on a spot basis for proton beams, where the precision is about 2.6~mm with a LM-MLEM reconstruction: a qualitative monitoring of each spot seems then possible. In order to achieve millimeter precision, some spot grouping methods must be considered, or multiple-head detector configurations, e.g in a ring geometry. As a general result, the LM-MLEM iterative algorithm, which is now the standard for this kind of image reconstruction,  guarantees a better fall-off identification precision over the whole explored intensity range. However, LM-MLEM does not exploit the additional information provided by the knowledge of the beam position in the transverse plane. In future studies, such \textit{a priori} information should be considered in order to improve the reconstruction rapidity and image quality. Moreover, the present version of the algorithm does not include regularization parameters, and leads to the creation of reconstruction artifacts for increasing number of iterations. Improved version of the LM-MLEM algorithm are under study: regularization strategies could allow for exploiting a larger number of iterations thus increasing the contrast in the fall-off region and the consequent fall-off identification precision. In addition to this, more restrictive data selection during reconstruction can in principle improve the image quality and speed up the reconstruction process. At present, given the long calculation time required by the iterative algorithm, the line-cone reconstruction method can still be an option for on-line treatment check, when safety limit can be fixed in order to exclude severe deviation from the treatment planning and an interruption of the dose delivery in real time can be foreseen. Moreover, the TOF information can be included in the line-cone reconstruction method in order to constrain the emission on a single point, and improve its accuracy.
Finally, it should be noticed that the presented study is focused on events involving one single scatterer layer: the inclusion of electron escape events can increase the reconstruction accuracy, given the constraint imposed on the reconstructed surface by the electron tracking information. Further study is needed to assess the gain in precision provided by such kind of events. 

The Compton detection principle has already proven its potential in detecting prompt gammas for ion beam therapy monitoring purpose, and the CLaRyS Compton camera prototype shows promising results for this application. The detector is now at the final development stage, its components are being tested on beam in clinical facilities and a first beam test with a complete system is foreseen for the next year. New simulation studies are to be carried out to benchmark the Compton camera device to other detection systems, like PET machines or collimated detectors, already used or tested in clinics for ion beam therapy monitoring. The proposed study verify the feasibility of range monitoring in particle therapy with the CLaRyS Compton camera with a minimal approach, and improved performance are expected after detector and reconstruction method optimization.           


